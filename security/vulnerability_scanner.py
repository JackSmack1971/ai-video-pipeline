from __future__ import annotations

import asyncio
import json
from pathlib import Path
from typing import List


class VulnerabilityScanner:
    async def scan_requirements(self, path: Path) -> List[str]:
        proc = await asyncio.create_subprocess_exec(
            "safety",
            "check",
            "--json",
            "-r",
            str(path),
            stdout=asyncio.subprocess.PIPE,
            stderr=asyncio.subprocess.PIPE,
        )
        out, _ = await proc.communicate()
        try:
            results = json.loads(out or "[]")
            return [r.get("package_name", "") for r in results]
        except Exception:
            return []
